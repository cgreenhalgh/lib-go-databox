

# libDatabox
`import "./"`

* [Overview](#pkg-overview)
* [Index](#pkg-index)
* [Subdirectories](#pkg-subdirectories)

## <a name="pkg-overview">Overview</a>
A golang library for interfacing with Databox APIs.

Install using go get github.com/me-box/lib-go-databox

Examples can be found in the samples directory




## <a name="pkg-index">Index</a>
* [Constants](#pkg-constants)
* [func ExportLongpoll(destination string, payload string) (string, error)](#ExportLongpoll)
* [func GetDsIdFromDsHref(href string) (string, error)](#GetDsIdFromDsHref)
* [func GetHttpsCredentials() string](#GetHttpsCredentials)
* [func GetStoreURLFromDsHref(href string) (string, error)](#GetStoreURLFromDsHref)
* [func JsonUnmarshal(s string) (map[string]interface{}, error)](#JsonUnmarshal)
* [func RegisterDatasource(href string, metadata StoreMetadata) (string, error)](#RegisterDatasource)
* [func StoreJSONGetlatest(href string) (string, error)](#StoreJSONGetlatest)
* [func StoreJSONGetrange(href string, startTimestamp float64, endTimestamp float64) (string, error)](#StoreJSONGetrange)
* [func StoreJSONGetsince(href string, startTimestamp float64) (string, error)](#StoreJSONGetsince)
* [func StoreJSONWriteKV(href string, data string) error](#StoreJSONWriteKV)
* [func StoreJSONWriteTS(href string, data string) error](#StoreJSONWriteTS)
* [func StoreJSONreadKV(href string, key string) (string, error)](#StoreJSONreadKV)
* [func StoreTsLast(href string, n int) (string, error)](#StoreTsLast)
* [func StoreTsLastNrange(href string, n int, startTimestamp int, endTimestamp int) (string, error)](#StoreTsLastNrange)
* [func StoreTsLastNsince(href string, n int, startTimestamp int) (string, error)](#StoreTsLastNsince)
* [func StoreTsLatest(href string) (string, error)](#StoreTsLatest)
* [func StoreTsRange(href string, startTimestamp int, endTimestamp int) (string, error)](#StoreTsRange)
* [func StoreTsSince(href string, startTimestamp int) (string, error)](#StoreTsSince)
* [func StoreTsWrite(href string, data string) (string, error)](#StoreTsWrite)
* [func WSConnect(href string) (chan []byte, error)](#WSConnect)
* [func WSSubscribe(href string, storeType string) (string, error)](#WSSubscribe)
* [func WSUnsubscribe(href string, storeType string) (string, error)](#WSUnsubscribe)
* [func WaitForStoreStatus(href string)](#WaitForStoreStatus)
* [type KeyValue_0_2_0](#KeyValue_0_2_0)
  * [func MakeSourcKeyValue_0_2_0(dsMetadata string) (KeyValue_0_2_0, error)](#MakeSourcKeyValue_0_2_0)
  * [func MakeStoreKeyValue_0_2_0(storeHref string, datasourceId string, storeType string) (KeyValue_0_2_0, error)](#MakeStoreKeyValue_0_2_0)
* [type StoreMetadata](#StoreMetadata)
* [type TimeSeries_0_2_0](#TimeSeries_0_2_0)
  * [func MakeSourceTimeSeries_0_2_0(dsMetadata string) (TimeSeries_0_2_0, error)](#MakeSourceTimeSeries_0_2_0)
  * [func MakeStoreTimeSeries_0_2_0(storeHref string, datasourceId string, storeType string) (TimeSeries_0_2_0, error)](#MakeStoreTimeSeries_0_2_0)


#### <a name="pkg-files">Package files</a>
[api-ks.go](/src/target/api-ks.go) [api-ts.go](/src/target/api-ts.go) [export.go](/src/target/export.go) [store-json.go](/src/target/store-json.go) [store-timeseries.go](/src/target/store-timeseries.go) [subscriptions.go](/src/target/subscriptions.go) [utils.go](/src/target/utils.go) 


## <a name="pkg-constants">Constants</a>
``` go
const STORE_JSON = "store-json"
```



## <a name="ExportLongpoll">func</a> [ExportLongpoll](/src/target/export.go?s=115:186#L8)
``` go
func ExportLongpoll(destination string, payload string) (string, error)
```


## <a name="GetDsIdFromDsHref">func</a> [GetDsIdFromDsHref](/src/target/utils.go?s=2561:2612#L108)
``` go
func GetDsIdFromDsHref(href string) (string, error)
```
GetDsIdFromDsHref extracts the base data source ID from the href provied in the DATASOURCE_[name] environment variable.



## <a name="GetHttpsCredentials">func</a> [GetHttpsCredentials](/src/target/utils.go?s=1752:1785#L78)
``` go
func GetHttpsCredentials() string
```
GetHttpsCredentials Returns a string containing the HTTPS credentials to pass to https server when offering an https server.
These are read form /run/secrets/DATABOX.pem and are generated by the container-manger at run time.



## <a name="GetStoreURLFromDsHref">func</a> [GetStoreURLFromDsHref](/src/target/utils.go?s=2271:2326#L96)
``` go
func GetStoreURLFromDsHref(href string) (string, error)
```
GetStoreURLFromDsHref extracts the base store url from the href provied in the DATASOURCE_[name] environment variable.



## <a name="JsonUnmarshal">func</a> [JsonUnmarshal](/src/target/utils.go?s=1942:2002#L84)
``` go
func JsonUnmarshal(s string) (map[string]interface{}, error)
```
JsonUnmarshal is a helper function to translate JSON stringified environment variable
to go map[string]



## <a name="RegisterDatasource">func</a> [RegisterDatasource](/src/target/utils.go?s=8179:8255#L357)
``` go
func RegisterDatasource(href string, metadata StoreMetadata) (string, error)
```
RegisterDatasource is used by apps and drivers to register datasource in stores they
own.



## <a name="StoreJSONGetlatest">func</a> [StoreJSONGetlatest](/src/target/store-json.go?s=43:95#L7)
``` go
func StoreJSONGetlatest(href string) (string, error)
```


## <a name="StoreJSONGetrange">func</a> [StoreJSONGetrange](/src/target/store-json.go?s=216:313#L18)
``` go
func StoreJSONGetrange(href string, startTimestamp float64, endTimestamp float64) (string, error)
```


## <a name="StoreJSONGetsince">func</a> [StoreJSONGetsince](/src/target/store-json.go?s=604:679#L30)
``` go
func StoreJSONGetsince(href string, startTimestamp float64) (string, error)
```


## <a name="StoreJSONWriteKV">func</a> [StoreJSONWriteKV](/src/target/store-json.go?s=1058:1111#L53)
``` go
func StoreJSONWriteKV(href string, data string) error
```


## <a name="StoreJSONWriteTS">func</a> [StoreJSONWriteTS](/src/target/store-json.go?s=901:954#L42)
``` go
func StoreJSONWriteTS(href string, data string) error
```


## <a name="StoreJSONreadKV">func</a> [StoreJSONreadKV](/src/target/store-json.go?s=1215:1276#L64)
``` go
func StoreJSONreadKV(href string, key string) (string, error)
```


## <a name="StoreTsLast">func</a> [StoreTsLast](/src/target/store-timeseries.go?s=298:350#L23)
``` go
func StoreTsLast(href string, n int) (string, error)
```


## <a name="StoreTsLastNrange">func</a> [StoreTsLastNrange](/src/target/store-timeseries.go?s=708:804#L41)
``` go
func StoreTsLastNrange(href string, n int, startTimestamp int, endTimestamp int) (string, error)
```


## <a name="StoreTsLastNsince">func</a> [StoreTsLastNsince](/src/target/store-timeseries.go?s=475:553#L32)
``` go
func StoreTsLastNsince(href string, n int, startTimestamp int) (string, error)
```


## <a name="StoreTsLatest">func</a> [StoreTsLatest](/src/target/store-timeseries.go?s=130:177#L12)
``` go
func StoreTsLatest(href string) (string, error)
```


## <a name="StoreTsRange">func</a> [StoreTsRange](/src/target/store-timeseries.go?s=1186:1270#L59)
``` go
func StoreTsRange(href string, startTimestamp int, endTimestamp int) (string, error)
```


## <a name="StoreTsSince">func</a> [StoreTsSince](/src/target/store-timeseries.go?s=981:1047#L50)
``` go
func StoreTsSince(href string, startTimestamp int) (string, error)
```


## <a name="StoreTsWrite">func</a> [StoreTsWrite](/src/target/store-timeseries.go?s=1432:1491#L69)
``` go
func StoreTsWrite(href string, data string) (string, error)
```


## <a name="WSConnect">func</a> [WSConnect](/src/target/subscriptions.go?s=290:338#L15)
``` go
func WSConnect(href string) (chan []byte, error)
```
WSConnect connects to a target store's notification service

Returns a chan []byte that recives data from every route the connecting container is subscribed to.
Data is a JSON string.



## <a name="WSSubscribe">func</a> [WSSubscribe](/src/target/subscriptions.go?s=1385:1448#L66)
``` go
func WSSubscribe(href string, storeType string) (string, error)
```
WSSubscribe Subscribes the caller to write notifications for a given route.



## <a name="WSUnsubscribe">func</a> [WSUnsubscribe](/src/target/subscriptions.go?s=1726:1791#L76)
``` go
func WSUnsubscribe(href string, storeType string) (string, error)
```
WSUnsubscribe Unsubscribes the caller to write notifications for a given route



## <a name="WaitForStoreStatus">func</a> [WaitForStoreStatus](/src/target/utils.go?s=7161:7197#L306)
``` go
func WaitForStoreStatus(href string)
```
WaitForStoreStatus will wait for the store available at href to respond with an active status.




## <a name="KeyValue_0_2_0">type</a> [KeyValue_0_2_0](/src/target/api-ks.go?s=190:485#L11)
``` go
type KeyValue_0_2_0 interface {
    // Read json-encoded value.
    //
    // Returns an error (404 not found) if no value was previously written.
    Read() (string, error)

    // Write json-encoded value.
    Write(data string) error

    // GetStoreURL returns the store URL (only)
    StoreURL() (string, error)
}
```
Datasource KeyValue API for databox v 0.2.0.

Strictly a subset of the API offered by the store-json and store-timeseries.







### <a name="MakeSourcKeyValue_0_2_0">func</a> [MakeSourcKeyValue_0_2_0](/src/target/api-ks.go?s=1959:2030#L72)
``` go
func MakeSourcKeyValue_0_2_0(dsMetadata string) (KeyValue_0_2_0, error)
```
Factory for a KeyValue_0_2_0 object suitable for the datasource.
Ideally the created object should depend on the runtime databox version
and the datasource store type.
datasourceMetadata is the environment string passed to the app from the container
manager which includes the datasource endpoint (href) and item-metadata
rel 'urn:X-databox:rels:hasStoreType'


### <a name="MakeStoreKeyValue_0_2_0">func</a> [MakeStoreKeyValue_0_2_0](/src/target/api-ks.go?s=1255:1364#L58)
``` go
func MakeStoreKeyValue_0_2_0(storeHref string, datasourceId string, storeType string) (KeyValue_0_2_0, error)
```
Factory for a KeyValue_0_2_0 object suitable for the store type.
Ideally the created object should depend on the runtime databox version
and the store type.
Supported storeType currently 'store-json' only.





## <a name="StoreMetadata">type</a> [StoreMetadata](/src/target/utils.go?s=7568:7802#L328)
``` go
type StoreMetadata struct {
    Description    string
    ContentType    string
    Vendor         string
    DataSourceType string
    DataSourceID   string
    StoreType      string
    IsActuator     bool
    Unit           string
    Location       string
}
```









## <a name="TimeSeries_0_2_0">type</a> [TimeSeries_0_2_0](/src/target/api-ts.go?s=350:1665#L17)
``` go
type TimeSeries_0_2_0 interface {
    // GetLatest returns the datasource's latest value, if any.
    //
    // Returns a single json-encoded value object, or "" if there is no value.
    ReadLatest() (string, error)

    // GetSince returns an array of values since time, inclusive.
    //
    // Returns a json-encoded array of value objects.
    ReadSince(startTime time.Time) (string, error)

    // GetSince returns an array of values between startTime (inclusive) and
    // endTime (inclusive).
    //
    // Returns a json-encoded array of value objects.
    ReadRange(startTime time.Time, endTime time.Time) (string, error)

    // WriteData writes a JSON-encoded value with no surrounding value object
    // or timestamp.
    // The time associated with the data will be assigned by the store.
    WriteRawValue(data string) error

    // WriteDataAndTime writes a JSON-encoded value with no surrounding value
    // object for the specified timestamp.
    WriteRawValueAt(data string, time time.Time) error

    // Time2Timestamp returns the (possibly store-specific) timestamp
    // for the given time.
    Time2Timestamp(t time.Time) float64

    // Timestamp2Time converts the (possibly store-specific) timestamp
    // from a value object to a time.
    Timestamp2Time(ts float64) time.Time

    // GetStoreURL returns the store URL (only)
    StoreURL() (string, error)
}
```
TimeSeries API for databox v 0.2.0.

Strictly a subset of the API offered by the store-json and store-timeseries
including common methods.

Note that a single store value is a JSON-encoded object with fields timestamp
(float64) and data (value type).







### <a name="MakeSourceTimeSeries_0_2_0">func</a> [MakeSourceTimeSeries_0_2_0](/src/target/api-ts.go?s=5043:5119#L164)
``` go
func MakeSourceTimeSeries_0_2_0(dsMetadata string) (TimeSeries_0_2_0, error)
```
Factory for a TimeSeries_0_2_0 object suitable for the datasource.
Ideally the created object should depend on the runtime databox version
and the datasource store type.
datasourceMetadata is the environment string passed to the app from the container
manager which includes the datasource endpoint (href) and item-metadata
rel 'urn:X-databox:rels:hasStoreType'


### <a name="MakeStoreTimeSeries_0_2_0">func</a> [MakeStoreTimeSeries_0_2_0](/src/target/api-ts.go?s=4329:4442#L150)
``` go
func MakeStoreTimeSeries_0_2_0(storeHref string, datasourceId string, storeType string) (TimeSeries_0_2_0, error)
```
Factory for a TimeSeries_0_2_0 object suitable for the store type.
Ideally the created object should depend on the runtime databox version
and the store type.
Supported storeType currently 'store-json' only.









- - -
Generated by [godoc2md](http://godoc.org/github.com/davecheney/godoc2md)
